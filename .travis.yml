sudo: required

language: minimal

services:
- docker

before_install:
- set -e
- openssl aes-256-cbc -K $encrypted_f0ce29948891_key -iv $encrypted_f0ce29948891_iv
  -in id_rsa.enc -out /tmp/deploy_rsa -d
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USER" --password-stdin
- docker build -t vycius/getpet-platform --build-arg GIT_COMMIT=${TRAVIS_COMMIT::8} .
- docker push vycius/getpet-platform
- eval "$(ssh-agent -s)"
- chmod 600 /tmp/deploy_rsa
- ssh-add /tmp/deploy_rsa
- set +e

after_success:
- set -e
- ssh -o "StrictHostKeyChecking no" -i /tmp/deploy_rsa $REMOTE_USER@$REMOTE_HOST 'bash -s' < config/deploy-travis.sh
- set +e